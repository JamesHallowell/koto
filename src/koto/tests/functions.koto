square = |x| x * x
assert_eq(square 7, 49)
assert_eq(square -10, 100)

add = |x, y|
  x2 = x
  do_add = |x, y|
    x = x + y # Nested trailing comment
    x
  result = do_add(x, y)
  assert x == x2 # function arguments are locally scoped TODO this breaks parsing on previous line
  result
assert_eq(add(1, 2), 3)

# functions can call globally defined functions
add2 = |x, y| add(x, y)
assert_eq(add2(4, -4), 0)

# functions can return multiple values
f = |x| x - 1, x + 1
a, b = f 0
assert (a == -1) and (b == 1)
